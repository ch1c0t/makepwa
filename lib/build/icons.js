// Generated by CoffeeScript 2.5.1
(function() {
  var DEFAULT_ICON, buildIconsFrom, createDefaultIcon, ensureDirExists, fs, pug, sharp;

  fs = require('fs');

  pug = require('pug');

  sharp = require('sharp');

  ({ensureDirExists} = require('../util'));

  DEFAULT_ICON = '/tmp/makepwa/icon.svg';

  exports.buildIcons = async function() {
    var file;
    ensureDirExists(`${DIST}/icons`);
    file = `${SRC}/icons/icon.svg`;
    if (fs.existsSync(file)) {
      return buildIconsFrom(file);
    } else {
      await createDefaultIcon();
      return buildIconsFrom(DEFAULT_ICON);
    }
  };

  createDefaultIcon = function() {
    var source;
    source = `svg(xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512")
  rect(width="100%" height="100%" fill="#f0f0f0")
  circle(cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="red")`;
    return IO.write(DEFAULT_ICON, pug.render(source));
  };

  buildIconsFrom = async function(file) {
    var i, len, size, sizes;
    sizes = [32, 180, 192, 512];
    for (i = 0, len = sizes.length; i < len; i++) {
      size = sizes[i];
      await sharp(file).resize(size).png().toFile(`${DIST}/icons/${size}.png`);
    }
    return (await IO.move(`${DIST}/icons/32.png`, `${DIST}/favicon.ico`));
  };

}).call(this);
