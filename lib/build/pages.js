// Generated by CoffeeScript 2.5.1
(function() {
  var basename, failIfDirNotExists, glob, injectScriptTags, pug;

  pug = require('pug');

  glob = require('glob');

  ({basename} = require('path'));

  ({failIfDirNotExists} = require('../util'));

  exports.buildPages = async function() {
    var dir, file, files, i, len, name, results, source;
    dir = `${SRC}/pages`;
    failIfDirNotExists(dir);
    files = glob.sync(`${dir}/*.pug`);
    results = [];
    for (i = 0, len = files.length; i < len; i++) {
      file = files[i];
      name = basename(file, '.pug');
      source = (await IO.read(file));
      results.push((await IO.write(`${DIST}/${name}.html`, pug.render(injectScriptTags(source)))));
    }
    return results;
  };

  injectScriptTags = function(source) {
    var tags;
    tags = glob.sync(`${DIST}/scripts/*.js`).map(function(script) {
      var name, path;
      name = basename(script);
      path = '"' + `/scripts/${name}` + '"';
      return `    script(src=${path})`;
    }).join('\n');
    return source + '\n' + tags + '\n';
  };

}).call(this);
