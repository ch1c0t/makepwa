// Generated by CoffeeScript 2.5.1
(function() {
  var buildDefaultSWRegistration, ensureDirExists, fs, runWebpack;

  fs = require('fs');

  ({ensureDirExists} = require('../../../util'));

  ({runWebpack} = require('../common'));

  exports.buildSWRegistration = function(config) {
    var file, output, targetDir;
    targetDir = `${DIST}/scripts`;
    ensureDirExists(targetDir);
    file = `${SRC}/scripts/register_sw.coffee`;
    output = `${targetDir}/register_sw.js`;
    if (fs.existsSync(file)) {
      return runWebpack({
        entry: file,
        output
      });
    } else {
      if (COMMAND === 'build') {
        return buildDefaultSWRegistration({output});
      }
    }
  };

  buildDefaultSWRegistration = async function(config) {
    var defaultFile;
    defaultFile = '/tmp/makepwa/register_sw.coffee';
    await IO.write(defaultFile, `if navigator.serviceWorker?.register
  window.addEventListener 'load', ->
    navigator.serviceWorker.register('/sw.js')
      .then (registration) ->
        console.log 'Service worker registration succeeded:', registration
      .catch (error) ->
        console.log 'Service worker registration failed:', error
else
  console.log "No 'serviceWorker' in the navigator."
  console.dir navigator`);
    config.entry = defaultFile;
    return runWebpack(config);
  };

}).call(this);
