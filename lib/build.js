// Generated by CoffeeScript 2.5.1
(function() {
  var CWD, DIST, SRC, basename, buildPages, ensureDirExists, existsSync, glob, pug, readFileSync, writeFileSync;

  ({existsSync, readFileSync, writeFileSync} = require('fs'));

  ({basename} = require('path'));

  glob = require('glob');

  pug = require('pug');

  ({ensureDirExists} = require('./util'));

  CWD = process.cwd();

  SRC = `${CWD}/src`;

  DIST = `${CWD}/dist`;

  exports.build = function() {
    ensureDirExists(DIST);
    return buildPages();
  };

  buildPages = function() {
    var dir, fn, i, j, len, names, results, source, sources;
    dir = `${SRC}/pages`;
    if (!existsSync(dir)) {
      console.log(`${dir} does not exist.`);
      process.exit(1);
    }
    sources = glob.sync(`${dir}/*.pug`);
    names = sources.map(function(file) {
      return basename(file, '.pug');
    });
    results = [];
    for (i = j = 0, len = sources.length; j < len; i = ++j) {
      source = sources[i];
      fn = pug.compile(readFileSync(source, 'utf-8'));
      results.push(writeFileSync(`${DIST}/${names[i]}.html`, fn()));
    }
    return results;
  };

}).call(this);
